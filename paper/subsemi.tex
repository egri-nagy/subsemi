\documentclass{amsart}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{color,hyperref}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{tikz}
\usetikzlibrary{matrix,arrows,positioning,automata}

\definecolor{darkblue}{rgb}{0.0,0.0,0.3}
\definecolor{lgr}{rgb}{0.8,0.8,0.8}
\hypersetup{colorlinks,breaklinks,
            linkcolor=darkblue,urlcolor=darkblue,
            anchorcolor=darkblue,citecolor=darkblue}

\usepackage[norelsize,ruled,vlined,linesnumbered]{algorithm2e}

\newcommand{\cT}{{\mathcal T}}
\newcommand{\cS}{{\mathcal S}}
\newcommand{\Sub}{\mathbf{Sub}}
\newcommand{\Set}{\mathbf{Set}}
\newcommand{\Pos}{\mathbf{Pos}}
\newcommand{\Max}{\mathbf{Max}}
\newcommand{\compl}{\mathsf{c}}

\DeclareMathOperator{\Aut}{Aut}

\newcommand{\todo}[1]{ \small \textsf{[TODO:  #1 ]} \normalsize}


\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{Proposition}[theorem]{Proposition}
\newtheorem{cor}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}

\newcommand{\SgpDec}{\textsc{SgpDec}}
\newcommand{\GAP}{\textsc{Gap}}
\newcommand{\Viz}{\textsc{Viz}}
\newcommand{\GraphViz}{\textsc{GraphViz}}



\begin{document}
\tableofcontents
\section{Introduction}
Previous efforts for enumerating semigroups were focused on the abstract case, enumerating by the order, and worked by finding all valid multiplication tables of the given size \cite{monoidenum2009}.
Here we enumerate transformation semigroups by degree.
For degree $n$ this is the task of enumerating all valid subtables inside one big multiplication table of the  full transformation semigroups $\cT_n$.

\section{Notation}
%Let $(X,S)$ be a transformation semigroup, $n=|S|$.
Let $S$ be finite a semigroup, $n=|S|$.
We fix an order on the semigroup elements $s_1,\ldots, s_n$, so we can easily refer to the elements by their indices. 
Then the  \emph{multiplication table}, or \emph{Cayley-table} of $S$ is a $n\times n$ matrix $M(S)$ or simply $M$ with entries from $\{1,..,n\}$ such that $M_{i,j}=k$ if $s_is_j=s_k$.
$R_i$ is the $i$th row and $C_j$ is the $j$th column vector of $M$.
We denote the set of the elements of a vector $v$ by $\Set(v)=\{x\mid x\in v\}$.
$\Pos(v,i)$ is the set of positions in vector $v$ containing the value $i$.

$\Sub(S)=\big\{T\mid T\leq S \big\}$ the set of all subsemigroups, $\Max(S)$ the set of maximal proper subsemigroups.
If $I$ is an ideal of $S$ then the \emph{Rees factor semigroup} $S/I$ has elements $S\setminus I\cup\{0\}$ with multiplication same as in $S$ except $I$ is replaced by zero.

$\cS_n$ denotes the symmetric group, $\cT_n$ the full transformation group on $n$ points.
\section{Useful facts}
We can simplify and parallelize enumerating subsemigroups by enumerating subsemigroups of its maximal subsemigroups and merge the results.
\begin{fact}
$\Sub(S)=\big( \bigcup_{T\in \Max(S)}\Sub(T)\big)\cup \{S\}$
\end{fact}
%\proof
%It follows from the fact that $\Sub(S)$ is an algebraic lattice.
%\qed

Once a subsemigroup is found, we can generate its conjugate subsemigroups.
\begin{fact}
$T\in\Sub(S)$ and $g\in \Aut(S)$ then $T^g\in\Sub(S)$.%$g^{-1}Tg\in\Sub(S)$.
\end{fact}
%\proof
%Let $s,t\in T$ and $T'=g^{-1}Tg$.
%$$g^{-1}sgg^{-1}tg=g^{-1}stg.$$
%\qed


Enumeration is truly parallel for an ideal and its corresponding factor semigroup followed by a combining the results.
\begin{lemma}
Let $I$ be an ideal of $S$, then $$\Sub(S)=\big\{\langle (T\setminus\{0\})\cup U \rangle\mid T\in \Sub(S/I), U\in\Sub(I)\big\}.$$
\end{lemma}
\proof

\qed

\section{Multiplication Table Algorithms}

\subsection{Closure Algorithms}

\subsubsection{Global Tables}
How can we produce element $i$?
All occurences of $k$ may be distributed all over the multiplication table $M$.
The table entries are located by coordinates $i,j$ such that $s_is_j=s_k$ or $s_js_i=s_k$.
From the point of calculating the closure we can  omit coordinates $i,j$ where $i=k$ of $j=k$. 
We do not need the order information, so we can talk about ordered pairs $(i,j)$, $i\leq j$. 
Let's denote the set of these pairs by $P_k$.
We do not want to check a coordinate more than once so instead of storing all pairs including $i$, we can simply record $i$ and all the other elements in those pairs.
For instance $i,j$ and $i,h$ can be stored as $(i,(h,j))$.
The local information table of $k$ is defined by
$$G_k=\bigcup_{(i,j)\in P_k} \left\{ (i,\{j\mid i\leq j\})\right\}.$$
Usage: we take $X\subseteq S$ and for all elements $k$ in $S\setminus X$ we check whether $G_k$ contains pairs from $X$. 

\subsubsection{Local Tables} What do I need to add when I include $k$?
 from the value, get the positions (value, positions) pairs
Given that $i$ is in, do we have to include $k$? The answer is by checking the positions. 

Let $V_i=\Set(R_i)\cup\Set(C_i)$, the values in generated by $i$. Then the  local information table for element $i$ is defined by
$$L_i=\bigcup_{k\in V_i}\left\{(k,\Pos(R_i,k)\cup\Pos(C_i,k))\right\}.$$

Usage: we extend $X\subseteq S$ by $i$, so we check $L_i$ for each value $k$ not in $X$ whether its positions contain some elements from $X$. 
\subsection{Isomorphism and Anti-Isomorphism of Multiplication Tables}
Two semigroups $S$ and $T$ are isomorphic or anti-isomorphic if $M(S)$ can be transformed into $M(T)$ by rearranging its columns and rows and transposing the table.
Therefore, an element of $C_2\times S_n$ can witness the isomorphism.
We do not have to search through the symmetric group, we only need to consider permutations that take an element to another one with the same type.
Type is defined by the following invariants.

\subsubsection{Invariants}
Any property that does not contain information about the ordering of the elements can be used as an invariant.
\begin{enumerate}
\item Distinct frequency values and the number of elements with a given frequency. Useless for groups.
\item Column and row partitions. This encodes how many distinct elements are in the right and left principal ideals. Useless for groups.
\item The diagonal partition. $|S|=n$ partitioned as a sum of number of occurences of elements in the diagonal. This can even tell some groups apart: $C_4\mapsto 2+2$, $C_x\times C_2\mapsto 4$, but it assings 2+6 to both $D_8$ and $Q_8$.
\item Distinct index-period types and their number of occurences. In the group case this invariant reduces to the order of elements, but it can distinguish between $D_8$ and $Q_8$. However, this invariant fails to detect the difference between some direct and semidirect products. For instance, $C_8\times C_2$ and $C_8\rtimes C_2$ both have 1 element of order 1, 3 of order 2, 4 of order 4, and 8 of order 8.
\end{enumerate} 
\todo{distinguish between table and element level invariants}
If all invariants check out, then we can use backtrack to find out whether one of the multiplication tables can be rearranged to get the other one.
The search space can be reduced by aligning elements with the same profile (frequency, diagonal frequency, index-period).
\section{Algorithms}
\begin{algorithm}
\SetKwInOut{Input}{input}\SetKwInOut{Output}{output}
\SetKwData{subs}{subs}
\SetKwFunction{SubSgps}{SubSgps}
\SetKwFunction{Extend}{Extend}
\Input{$S$ semigroup}
\Output{$\Sub(S)$}
\SetKwInOut{Name}{\SubSgps($S$)}
\BlankLine
\Name{}

\subs $\leftarrow$ $\varnothing$
\For{$s\in S$}{
      \Extend($\varnothing,s,S$,\subs)
    }
\Return{\subs}
\caption{The main loop for enumerating all subsemigroups of $S$ by recursively extending the empty semigroup by all elements of $S$.}
\label{alg:basicloop}
\end{algorithm}

\begin{algorithm}
\SetKwInOut{Input}{input}\SetKwInOut{Output}{output}
\SetKwData{subs}{subs}
\SetKwData{diff}{diff}
\SetKwFunction{Extend}{Extend}
\Input{$S$ semigroup, $T\leq S$, \subs, $s\in S$ }
\Output{\subs with all possible extensions of $T$ added}
\SetKwInOut{Name}{\Extend($T$,$s$,$S$,\subs)}
\BlankLine
\Name{}

$T'$ $\leftarrow$ $\langle T\cup\{s\}\rangle$\\
    \If{$T'\notin$ \subs}{
      \subs$\leftarrow$ \subs$\cup\{T'\}$\\
      \diff $\leftarrow$ $S\setminus T'$\\
      \For{$t\in$\diff}{
      \Extend($T',t,S$,\subs)
    }
  }
\caption{Ext}
\label{alg:basicextend}
\end{algorithm}


\section{Enumerating transformation semigroups of degree 2,3 and 4}

\todo{explain frequencies of elements in multiplication table}

\bibliography{subsemi}
\bibliographystyle{plain}

\end{document}